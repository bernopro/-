/* ==========================
   KEY DATABASE (MAX 4 SIGNS)
========================== */

const majorKeys = ["C","G","D","A","E","F","Bb","Eb","Ab"];
const minorKeys = ["A","E","B","F#","C#","D","G","C","F"];
const notes = ["Դո","Ռե","Մի","Ֆա","Սոլ","Լա","Սի"];
/* ==========================
   ARMENIAN NOTE NAMES
========================== */

const armenianNotesMap = {
    "C": "Դո",
    "G": "Սոլ",
    "D": "Ռե",
    "A": "Լա",
    "E": "Մի",
    "F": "Ֆա",
    "Bb": "Սի♭",
    "Eb": "Մի♭",
    "Ab": "Լա♭",
    "B": "Սի",
    "F#": "Ֆա#",
    "C#": "Դո#"
};

/* ==========================
   RANDOM HELPERS
========================== */

function randomItem(arr){
    return arr[Math.floor(Math.random()*arr.length)];
}

let ticketNumber;

// Structure type (1–4 repeating)
const ticketStructure = ((ticketNumber - 1) % 4) + 1;

const isMajorTicket = [1,3,5,7,9,13,15,17,19,20].includes(ticketNumber);

const key = isMajorTicket ? randomItem(majorKeys) : randomItem(minorKeys);
const note = randomItem(notes);

const armenianKeyName = armenianNotesMap[key];

document.getElementById("ticketType").innerHTML =
`
Տոմս №${ticketNumber} (Տիպ ${ticketStructure})<br>
${armenianKeyName} ${isMajorTicket ? "մաժոր" : "մինոր"}
`;



    `Հարցաթերթիկ ${ticketNumber} — ${armenianKeyName} ${isMajorTicket ? "մաժոր" : "մինոր"}`;

/* ==========================
   TICKET STRUCTURES
========================== */

/* ==========================
   ALL 20 TICKETS
========================== */



const tickets = {

1: (dur, moll, note) => `Կառուցել՝
1. ${dur} բնական, հարմոնիկ, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${dur} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${dur}-ում T35 շրջվածքներով, D-ային եռատոներ՝ լուծումով, D56 լուծումով:
4. ${note} հնչյունից մաքուր ինտերվալներ, մաժոր եռահնչյուն, մաժոր սեքստակորդ, D2 լուծումով և տոնայնության որոշմամբ:`,

2: (dur, moll, note) => `Կառուցել՝
1. ${moll} հարմոնիկ, մեղեդային, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${moll} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${moll}-ում t35, s35, բնորոշ ինտերվալներ (մծց 2 և փքց 7) լուծումով, VII7 (2 տեսակի լուծումով):
4. ${note} հնչյունից մեծ և փոքր սեկունդա, մեծ և փոքր տերցիա, մաժոր և մինոր եռահնչյուններ, D7 լուծումով և տոնայնության որոշմամբ:`,

3: (dur, moll, note) => `Կառուցել՝
1. ${dur} բնական, հարմոնիկ, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${dur} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${dur}-ում S35 շրջվածքներով, S-ային եռատոներ՝ լուծումով, D34 լուծումով:
4. ${note} հնչյունից փոքր ինտերվալներ, մինոր եռահնչյուն, մինոր սեքստակորդ, D56 լուծումով և տոնայնության որոշմամբ:`,

4: (dur, moll, note) => `Կառուցել՝
1. ${moll} հարմոնիկ, մեղեդային, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${moll} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${moll}-ում t35, s35, D-ային եռատոներ՝ լուծումով, փքց35 (VII) լուծումով և D56 լուծումով:
4. ${note} հնչյունից մաքուր կվարտա և մաքուր կվինտա, 4 տեսակի եռահնչյուն, D7 լուծումով և տոնայնության որոշմամբ:`,

5: (dur, moll, note) => `Կառուցել՝
1. ${dur} բնական, հարմոնիկ, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${dur} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${dur}-ում D35 շրջվածքներով, բնորոշ ինտերվալներ (մծց 5 և փքց 4) լուծումով, D2 լուծումով:
4. ${note} հնչյունից մաքուր կվարտա և մաքուր կվինտա, մեծ ու փոքր սեքստաներ, մաժոր և մինոր կվարտսեքսակորդներ, D2 լուծումով և տոնայնության որոշմամբ:`,

6: (dur, moll, note) => `Կառուցել՝
1. ${moll} հարմոնիկ, մեղեդային, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${moll} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${moll}-ում t35, D35, D7 շրջվածքներով և լուծումներով:
4. ${note} հնչյունից մեծ ինտերվալներ, մինոր եռահնչյուն, մինոր կվարտսեքստակորդ, D34 լուծումով և տոնայնության որոշմամբ:`,

7: (dur, moll, note) => `Կառուցել՝
1. ${dur} բնական, հարմոնիկ, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${dur} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${dur}-ում T35, D35, մծց 2 և փքց 7 լուծումով, փքց VII7 (2 տեսակի լուծումով):
4. ${note} հնչյունից մեծ և փոքր սեկունդաներ, մեծ և փոքր տերցիաներ, մաժոր եռահնչյուն, մինոր սեքստակորդ, D56 լուծումով և տոնայնության որոշմամբ:`,

8: (dur, moll, note) => `Կառուցել՝
1. ${moll} հարմոնիկ, մեղեդային, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${moll} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${moll}-ում t35, D-ային եռատոներ՝ լուծումով, փքց35 (VII և II աստիճաններից՝ լուծումով), D56 լուծումով:
4. ${note} հնչյունից մաքուր կվարտա և մաքուր կվինտա, 4 տեսակի եռահնչյուն, D7 լուծումով և տոնայնության որոշմամբ:`,

9: (dur, moll, note) => `Կառուցել՝
1. ${dur} բնական, հարմոնիկ, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${dur} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${dur}-ում T35, S35, բնորոշ ինտերվալներ (մծց 2 և փքց 7) լուծումով, փքց VII7 (2 տեսակի լուծումով):
4. ${note} հնչյունից մ3, փ3, մ6, փ6, մաժոր և մինոր եռահնչյուններ, D34 լուծումով և տոնայնության որոշմամբ:`,

10: (dur, moll, note) => `Կառուցել՝
1. ${moll} հարմոնիկ, մեղեդային, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${moll} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${moll}-ում t35, s35, D-ային եռատոներ՝ լուծումով, փքց35 (VII) լուծումով և D56 լուծումով:
4. ${note} հնչյունից մեծ ու փոքր տերցիաներ, շրջել և որոշել ստացված ինտերվալը, մաժոր և մինոր սեքստակորդներ, D34 լուծումով և տոնայնության որոշմամբ:`,

11: (dur, moll, note) => `Կառուցել՝
1. ${moll} հարմոնիկ, մեղեդային, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${moll} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${moll}-ում s35, D35, մծց 2 և փքց 7 լուծումով, VII7 (2 տեսակի լուծումով):
4. ${note} հնչյունից մաքուր կվարտա և մաքուր կվինտա, 4 տեսակի եռահնչյուն, D7 լուծումով և տոնայնության որոշմամբ:`,

12: (dur, moll, note) => `Կառուցել՝
1. ${moll} հարմոնիկ, մեղեդային, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${moll} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${moll}-ում t35, s35, D-ային եռատոներ՝ լուծումով, VII7 (2 տեսակի լուծումով):
4. ${note} հնչյունից մեծ ու փոքր սեկունդա, մեծ ու փոքր տերցիա, մաժոր եռահնչյուն, մինոր սեքստակորդ, D2 լուծումով և տոնայնության որոշմամբ:`,

13: (dur, moll, note) => `Կառուցել՝
1. ${dur} բնական, հարմոնիկ, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${dur} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${dur}-ում T35 շրջվածքներով, D-ային եռատոներ՝ լուծումով, D7 լուծումով:
4. ${note} հնչյունից մեծ ու փոքր տերցիաներ՝ շրջել, որոշելով ստացվածը, մաժոր կվարտսեքստակորդ, մինոր սեքստակորդ, D34 լուծումով և տոնայնության որոշմամբ:`,

14: (dur, moll, note) => `Կառուցել՝
1. ${moll} հարմոնիկ, մեղեդային, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${moll} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${moll}-ում t35, s35, մծց 2 և փքց 7 լուծումով, VII7 (2 տեսակի լուծումով):
4. ${note} հնչյունից մաքուր ինտերվալներ, մաժոր եռահնչյուն, մինոր սեքստակորդ, D2 լուծումով և տոնայնության որոշմամբ:`,

15: (dur, moll, note) => `Կառուցել՝
1. ${dur} բնական, հարմոնիկ, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${dur} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${dur}-ում D35 շրջվածքներով, բնորոշ ինտերվալներ (մծց 2 և փքց 7) լուծումով, D2 լուծումով:
4. ${note} հնչյունից մաքուր կվարտա և մաքուր կվինտա, մեծ ու փոքր սեքստաներ, մաժոր և մինոր կվարտսեքսակորդներ, D34 լուծումով և տոնայնության որոշմամբ:`,

16: (dur, moll, note) => `Կառուցել՝
1. ${moll} հարմոնիկ, մեղեդային, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${moll} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${moll}-ում t35, s35, S-ային եռատոներ, փքց35 (II) լուծումով և D34 լուծումով:
4. ${note} հնչյունից մեծ ինտերվալներ, մինոր եռահնչյուն, մաժոր սեքստակորդ, D34 լուծումով և տոնայնության որոշմամբ:`,

17: (dur, moll, note) => `Կառուցել՝
1. ${dur} բնական, հարմոնիկ, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${dur} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${dur}-ում D35 շրջվածքներով, բնորոշ ինտերվալներ (մծց 2 և փքց 7) լուծումով, D7 լուծումով:
4. ${note} հնչյունից մ3, փ3, մ6, փ6, մաժոր և մինոր եռահնչյուններ, D34 լուծումով և տոնայնության որոշմամբ:`,

18: (dur, moll, note) => `Կառուցել՝
1. ${moll} հարմոնիկ, մեղեդային, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${moll} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${moll}-ում t35 շրջվածքներով, S-ային եռատոներ լուծումով, D56 լուծումով:
4. ${note} հնչյունից մաքուր կվարտա և մաքուր կվինտա, 4 տեսակի եռահնչյուն, D7 լուծումով և տոնայնության որոշմամբ:`,

19: (dur, moll, note) => `Կառուցել՝
1. ${dur} բնական, հարմոնիկ, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${dur} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${dur}-ում T35, D35, բնորոշ ինտերվալներ (մծց 5 և փքց 4) լուծումներով, մծց35 լուծումով, D34 լուծումով:
4. ${note} հնչյունից մեծ ինտերվալներ, մաժոր եռահնչյուն, մաժոր կվարտսեքստակորդ, D34 լուծումով և տոնայնության որոշմամբ:`,

20: (dur, moll, note) => `Կառուցել՝
1. ${dur} բնական, հարմոնիկ, կայուն, անկայուն (լուծումներով) և ձգտող տոներ:
2. ${dur} քրոմատիկ վերընթաց և վարընթաց գամմա:
3. ${dur}-ում S35, D35, D-ային եռատոներ՝ լուծումով, փքց35 (VII) լուծումով, D56 լուծումով:
4. ${note} հնչյունից մեծ ու փոքր տերցիաներ՝ շրջել, որոշելով ստացված ինտերվալը, մաժոր և մինոր սեքստակորդներ, D56 լուծումով և տոնայնության որոշմամբ:`

};



function generateTicket(){

    const ticketStructure = ((ticketNumber - 1) % 4) + 1;
    const isMajorTicket = [1,3,5,7,9,13,15,17,19,20].includes(ticketNumber);

    const key = isMajorTicket ? randomItem(majorKeys) : randomItem(minorKeys);
    const note = randomItem(notes);
    const armenianKeyName = armenianNotesMap[key];

    const dur = `${armenianKeyName} մաժոր`;
    const moll = `${armenianKeyName} մինոր`;

   const ticketContent = tickets[ticketNumber](dur, moll, note);


    const area = document.getElementById("questionsArea");
    area.innerHTML = "";

    const div = document.createElement("div");
    div.style.marginBottom = "40px";
    div.style.whiteSpace = "pre-line";

    div.innerText = ticketContent;

    area.appendChild(div);

document.getElementById("ticketType").innerHTML =
`Հարցաթերթիկ №${ticketNumber}<br>
 Տոնայնություն՝ ${armenianKeyName} ${isMajorTicket ? "մաժոր" : "մինոր"}`;


}



const select = document.getElementById("ticketSelect");

for(let i = 1; i <= 20; i++){
    const option = document.createElement("option");
    option.value = i;
    option.textContent = "Տոմս " + i;
    select.appendChild(option);
}
function startRandomAll(){
    ticketNumber = Math.floor(Math.random()*20) + 1;
    generateTicket();
}

function startRandomFirst10(){
    ticketNumber = Math.floor(Math.random()*10) + 1;
    generateTicket();
}

function startFromDropdown(){
    const selected = document.getElementById("ticketSelect").value;
    if(selected){
        ticketNumber = parseInt(selected);
        generateTicket();
    }
}

/* ==========================
   DISPLAY QUESTIONS LARGE
========================== */

/* ==========================
   PNG EXPORT
========================== */

function downloadPNG(){

    if(!ticketNumber){
        alert("Նախ ընտրեք տոմսը");
        return;
    }

    const imagePath = `images/Solfejo_Ticket_${ticketNumber}.png`;

    window.open(imagePath, "_blank");
}

function exportAllTickets(){

    let current = 1;

    function next(){

        if(current > 20) return;

        ticketNumber = current;
        generateTicket(); // regenerate content

        setTimeout(() => {

            html2canvas(document.getElementById("ticketArea"),{
                scale:2
            }).then(canvas=>{

                const link = document.createElement("a");
                link.download = `Solfejo_Ticket_${current}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();

                current++;
                next();

            });

        }, 300); // small delay so DOM updates
    }

    next();
}


startRandomAll();
